<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-01-03">

<title>Qualitative guide for R - 3 — Group and code responses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Qualitative guide for R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tidy-MN/qualitative-guide" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#crayon-colors" id="toc-crayon-colors" class="nav-link active" data-scroll-target="#crayon-colors">Crayon colors</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#find-color-words" id="toc-find-color-words" class="nav-link" data-scroll-target="#find-color-words">Find color words</a></li>
  <li><a href="#fuzzy-join" id="toc-fuzzy-join" class="nav-link" data-scroll-target="#fuzzy-join">Fuzzy join</a></li>
  <li><a href="#create-the-group-table" id="toc-create-the-group-table" class="nav-link" data-scroll-target="#create-the-group-table">Create the group table</a></li>
  <li><a href="#join-groups-with-fuzzy_left_join" id="toc-join-groups-with-fuzzy_left_join" class="nav-link" data-scroll-target="#join-groups-with-fuzzy_left_join">Join groups with fuzzy_left_join</a></li>
  <li><a href="#set-group-to-other-for-the-nas" id="toc-set-group-to-other-for-the-nas" class="nav-link" data-scroll-target="#set-group-to-other-for-the-nas">Set group to “other” for the <code>NA</code>’s</a></li>
  <li><a href="#finding-complete-words" id="toc-finding-complete-words" class="nav-link" data-scroll-target="#finding-complete-words">Finding complete words</a></li>
  </ul></li>
  <li><a href="#assign-umbrella-groups-parent-and-child-nodes" id="toc-assign-umbrella-groups-parent-and-child-nodes" class="nav-link" data-scroll-target="#assign-umbrella-groups-parent-and-child-nodes">Assign umbrella groups: Parent and child nodes</a></li>
  <li><a href="#fuzzy-join-primary-and-secondary" id="toc-fuzzy-join-primary-and-secondary" class="nav-link" data-scroll-target="#fuzzy-join-primary-and-secondary">Fuzzy join primary and secondary</a></li>
  <li><a href="#assign-multiple-tags" id="toc-assign-multiple-tags" class="nav-link" data-scroll-target="#assign-multiple-tags">Assign multiple tags</a>
  <ul class="collapse">
  <li><a href="#load-kids-tv-data" id="toc-load-kids-tv-data" class="nav-link" data-scroll-target="#load-kids-tv-data">Load kids TV data</a></li>
  <li><a href="#split-up-unnest-every-word-for-easy-group-joining" id="toc-split-up-unnest-every-word-for-easy-group-joining" class="nav-link" data-scroll-target="#split-up-unnest-every-word-for-easy-group-joining">Split up / <code>unnest</code> every word for easy group joining</a></li>
  <li><a href="#load-the-parent-and-child-node-table" id="toc-load-the-parent-and-child-node-table" class="nav-link" data-scroll-target="#load-the-parent-and-child-node-table">Load the parent and child node table</a></li>
  <li><a href="#join-the-parentchild-nodes-table-to-the-tv_shows" id="toc-join-the-parentchild-nodes-table-to-the-tv_shows" class="nav-link" data-scroll-target="#join-the-parentchild-nodes-table-to-the-tv_shows">Join the parent/child <code>nodes</code> table to the <code>tv_shows</code></a></li>
  </ul></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize">Summarize</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">3 — Group and code responses</h1>
  <div class="quarto-categories">
    <div class="quarto-category">code</div>
    <div class="quarto-category">group</div>
    <div class="quarto-category">themes</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 3, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">January 8, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="crayon-colors" class="level2">
<h2 class="anchored" data-anchor-id="crayon-colors">Crayon colors</h2>
<p><img src="crayons.jpg" style="margin-right: 16px; margin-bottom: 2px; margin-left: -20px;" align="left" width="184" alt="A box of 12 Crayola crayons."></p>
<p>Let’s start simple and assign crayons a color based on their descriptive names. Below is a table of 12 crayons and their names. We want to create a group for each of the primary colors - <code>red</code>, <code>yellow</code>, and <code>blue</code> - and an everything-else group labeled <code>other</code>.</p>
<p>We’ll begin by searching for the primary color words in the name column of each of the crayons. If a color word is <em>detected</em>, it will be assigned to the appropriate group.</p>
<section id="load-the-data" class="level3">
<h3 class="anchored" data-anchor-id="load-the-data">Load the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>crayons <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://tidy-mn.github.io/qualitative-guide/posts/data/crayons.csv'</span>) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>crayons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
      id name            
   &lt;dbl&gt; &lt;chr&gt;           
 1     1 brick red       
 2     2 vibrant orange  
 3     3 warm yellow     
 4     4 slate green     
 5     5 indigo blue     
 6     6 grey black      
 7     7 plum purple     
 8     8 beige brown     
 9     9 denim blue      
10    10 incredible pink 
11    11 sap green       
12    12 cloudy off-white</code></pre>
</div>
</div>
</section>
<section id="find-color-words" class="level3">
<h3 class="anchored" data-anchor-id="find-color-words">Find color words</h3>
<p>We’ll use <code>case_when()</code> and <code>str_detect()</code> to test if a crayon name contains a given primary color word. If it does, we’ll assign the crayon to that color. If none of the primary color words are detected, the crayon will be assigned to the group <code>other</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="ot">&lt;-</span> crayons <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">"red"</span>) <span class="sc">~</span> <span class="st">"RED"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">str_detect</span>(name, <span class="st">"yellow"</span>) <span class="sc">~</span> <span class="st">"YELLOW"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">str_detect</span>(name, <span class="st">"blue"</span>) <span class="sc">~</span> <span class="st">"BLUE"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">.default =</span> <span class="st">"other"</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
     id name           group 
  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; 
1     1 brick red      RED   
2     2 vibrant orange other 
3     3 warm yellow    YELLOW
4     4 slate green    other 
5     5 indigo blue    BLUE  </code></pre>
</div>
</div>
</section>
<section id="fuzzy-join" class="level3">
<h3 class="anchored" data-anchor-id="fuzzy-join">Fuzzy join</h3>
<p>The approach above works well for a small number of groups, but it can be cumbersome when you have lots of groups to assign. If we wanted to sort the crayons into many more color groups, a better approach would be to create a table to store our group names and the associated color word.</p>
<p>Then we can use <code>fuzzyjoin</code> to join the groups table to the crayons table. The end result is the same, but it requires less code and will be much easier to update when we want to add new groups or change the words associated with a group.</p>
<p>Here’s the same example as above using the new table approach.</p>
</section>
<section id="create-the-group-table" class="level3">
<h3 class="anchored" data-anchor-id="create-the-group-table">Create the group table</h3>
<p>First, create a table of our groups with two columns:</p>
<ul>
<li><code>group</code> The group name</li>
<li><code>word</code> The word associated with the group</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fuzzyjoin)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>color_groups <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">c</span>(<span class="st">'RED'</span>,<span class="st">'YELLOW'</span>,<span class="st">'BLUE'</span>), </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">word =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"yellow"</span>, <span class="st">"blue"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="join-groups-with-fuzzy_left_join" class="level3">
<h3 class="anchored" data-anchor-id="join-groups-with-fuzzy_left_join">Join groups with fuzzy_left_join</h3>
<p>Now we can join our two tables using the <code>name</code> column in the <em>crayons</em> table, and the <code>word</code> column in the <em>color_groups</em> table. The function used to search text for a given word is <code>str_detect</code>, which tests whether a given color word occurs anywhere in the crayon’s name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="ot">&lt;-</span> crayons <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">fuzzy_left_join</span>(color_groups, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> <span class="fu">join_by</span>(name <span class="sc">==</span> word), </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">match_fun =</span> str_detect)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
     id name           group  word  
  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt; 
1     1 brick red      RED    red   
2     2 vibrant orange &lt;NA&gt;   &lt;NA&gt;  
3     3 warm yellow    YELLOW yellow
4     4 slate green    &lt;NA&gt;   &lt;NA&gt;  
5     5 indigo blue    BLUE   blue  
6     6 grey black     &lt;NA&gt;   &lt;NA&gt;  </code></pre>
</div>
</div>
</section>
<section id="set-group-to-other-for-the-nas" class="level3">
<h3 class="anchored" data-anchor-id="set-group-to-other-for-the-nas">Set group to “other” for the <code>NA</code>’s</h3>
<p>Finally, we’ll use <code>replace_na()</code> to assign the crayons without a color group to the group “other”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="ot">&lt;-</span> crayons_groups <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">group =</span> <span class="st">"other"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, name, group) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
      id name            group 
   &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt; 
 1     1 brick red       RED   
 2     2 vibrant orange  other 
 3     3 warm yellow     YELLOW
 4     4 slate green     other 
 5     5 indigo blue     BLUE  
 6     6 grey black      other 
 7     7 plum purple     other 
 8     8 beige brown     other 
 9     9 denim blue      BLUE  
10    10 incredible pink RED   </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Wait…what about row number 10? That’s interesting.</p>
<p>Why do you think the <strong>incredible pink</strong> crayon was assigned to the group <code>RED</code>?</p>
</blockquote>
</section>
<section id="finding-complete-words" class="level3">
<h3 class="anchored" data-anchor-id="finding-complete-words">Finding complete words</h3>
<p>In the example above, the function <code>str_detect()</code> looked for the occurrence of the designated letters anywhere in the crayon name. So the pattern of letters “r-e-d” is detected even if it occurs within another word. In this case, the pattern occurs within the name “inc<strong>red</strong>ible pink”. That could be useful in some contexts, but in our current crayon situation, we only want to detect the word “red”.</p>
<p>To ensure the color “red” is only detected as a complete word, we can add a special character to the start and end of our search term. Adding the character <code>\\b</code> to both sides of “red” will require the letters “r-e-d” to occur as its own word and not as part of a longer word.</p>
<p>Finally, let’s paste <code>\\b</code> to both sides of the color words in the <em>color_groups</em> table and then try our <code>fuzzy_left_join</code> one more time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>color_groups <span class="ot">&lt;-</span> color_groups <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, word, <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the groups again, but with the added separate word requirement</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="ot">&lt;-</span> crayons <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">fuzzy_left_join</span>(color_groups, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> <span class="fu">join_by</span>(name <span class="sc">==</span> word), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">match_fun =</span> str_detect)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">group =</span> <span class="st">"other"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, name, group) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
      id name            group 
   &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt; 
 1     1 brick red       RED   
 2     2 vibrant orange  other 
 3     3 warm yellow     YELLOW
 4     4 slate green     other 
 5     5 indigo blue     BLUE  
 6     6 grey black      other 
 7     7 plum purple     other 
 8     8 beige brown     other 
 9     9 denim blue      BLUE  
10    10 incredible pink other </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Success!</strong></p>
</blockquote>
</section>
</section>
<section id="assign-umbrella-groups-parent-and-child-nodes" class="level2">
<h2 class="anchored" data-anchor-id="assign-umbrella-groups-parent-and-child-nodes">Assign umbrella groups: Parent and child nodes</h2>
<p>We want to sort our crayons into primary colors and secondary colors. To do this we’ll need to check a crayon name for multiple words. For example, a crayon will be assigned to the primary color group if any of the following words occur in its name: <code>red</code>, <code>yellow</code>, or <code>blue</code>.</p>
<p>The larger umbrella group is sometimes referred to as the <em>parent node</em>, and the individual terms that fall under it are its <em>children nodes</em>. Here’s the table of our color groups in terms of parent and child nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>color_group_nodes <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>parent, <span class="sc">~</span>child,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"primary"</span>,   <span class="st">"red"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"primary"</span>,   <span class="st">"yellow"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"primary"</span>,   <span class="st">"blue"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"secondary"</span>, <span class="st">"green"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"secondary"</span>, <span class="st">"orange"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"secondary"</span>, <span class="st">"purple"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fuzzy-join-primary-and-secondary" class="level2">
<h2 class="anchored" data-anchor-id="fuzzy-join-primary-and-secondary">Fuzzy join primary and secondary</h2>
<p>Now we can repeat our previous fuzzy join steps to assign each of the crayons to the groups: <code>primary</code>, <code>secondary</code>, or <code>other</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>color_group_nodes <span class="ot">&lt;-</span> color_group_nodes <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">child_word =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, child, <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the primary/secondary groups</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="ot">&lt;-</span> crayons <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">fuzzy_left_join</span>(color_group_nodes, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> <span class="fu">join_by</span>(name <span class="sc">==</span> child_word), </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">match_fun =</span> str_detect) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">parent =</span> <span class="st">"other"</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>crayons_groups <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, name, parent, child) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
      id name            parent    child 
   &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt; 
 1     1 brick red       primary   red   
 2     2 vibrant orange  secondary orange
 3     3 warm yellow     primary   yellow
 4     4 slate green     secondary green 
 5     5 indigo blue     primary   blue  
 6     6 grey black      other     &lt;NA&gt;  
 7     7 plum purple     secondary purple
 8     8 beige brown     other     &lt;NA&gt;  
 9     9 denim blue      primary   blue  
10    10 incredible pink other     &lt;NA&gt;  </code></pre>
</div>
</div>
</section>
<section id="assign-multiple-tags" class="level2">
<h2 class="anchored" data-anchor-id="assign-multiple-tags">Assign multiple tags</h2>
<p>When we work with longer pieces of text we may want to assign it multiple groups or tags. For example, the description of a kids’ TV show may be about both <code>dinosaurs</code> and <code>siblings</code>.</p>
<p>In this example we will label the shows about people and tag each description with the type of people it references, such as <code>sister</code>, <code>brother</code>, or <code>grandmother</code>.</p>
<section id="load-kids-tv-data" class="level3">
<h3 class="anchored" data-anchor-id="load-kids-tv-data">Load kids TV data</h3>
<div class="cell" data-hash="index_str_detect_cache/html/unnamed-chunk-10_f3761639a3c5c6f1b637102e1af0b6f8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fuzzyjoin)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>tv_shows <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://tidy-mn.github.io/qualitative-guide/posts/data/kids_netflix_shows.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="split-up-unnest-every-word-for-easy-group-joining" class="level3">
<h3 class="anchored" data-anchor-id="split-up-unnest-every-word-for-easy-group-joining">Split up / <code>unnest</code> every word for easy group joining</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tv_shows <span class="ot">&lt;-</span> tv_shows <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unnest_tokens</span>(word, description, <span class="at">drop =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-parent-and-child-node-table" class="level3">
<h3 class="anchored" data-anchor-id="load-the-parent-and-child-node-table">Load the parent and child node table</h3>
<p>Here we provide an example parent/child node table to tag descriptions with various types of people. We include both the singular and plural version of a term - such as <em>uncle</em> and <em>uncles</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tv_nodes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://tidy-mn.github.io/qualitative-guide/posts/data/people_nodes.csv"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>tv_nodes <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  parent child child_words
  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      
1 people aunt  aunt       
2 people aunt  aunts      
3 people boy   boy        
4 people boy   boys       
5 people child child      
6 people child children   </code></pre>
</div>
</div>
</section>
<section id="join-the-parentchild-nodes-table-to-the-tv_shows" class="level3">
<h3 class="anchored" data-anchor-id="join-the-parentchild-nodes-table-to-the-tv_shows">Join the parent/child <code>nodes</code> table to the <code>tv_shows</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tv_groups <span class="ot">&lt;-</span> tv_shows <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">left_join</span>(tv_nodes, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">join_by</span>(word <span class="sc">==</span> child_words))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the rows/words with no word matches</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>tv_groups <span class="ot">&lt;-</span> tv_groups <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(parent))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View word matches</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>tv_groups <span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(title, description, parent, child) <span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(child) <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 75%">
<col style="width: 3%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">title</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">parent</th>
<th style="text-align: left;">child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Heidi, bienvenida a casa</td>
<td style="text-align: left;">Inspired by the classic novel, this telenovela follows Heidi, who leaves her happy life in the mountains behind when her aunt takes her to the big city.</td>
<td style="text-align: left;">people</td>
<td style="text-align: left;">aunt</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hotel Transylvania</td>
<td style="text-align: left;">With her dad away, Mavis is so ready for adventure – if strict Aunt Lydia doesn’t stop her first. Set four years before the “Hotel Transylvania” film.</td>
<td style="text-align: left;">people</td>
<td style="text-align: left;">aunt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Judy Moody and the Not Bummer Summer</td>
<td style="text-align: left;">In this family film, never-dull third-grader Judy Moody embarks on a summer adventure with her brother, Stink, and always-up-for-fun Aunt Opal.</td>
<td style="text-align: left;">people</td>
<td style="text-align: left;">aunt</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rip Tide</td>
<td style="text-align: left;">Following an embarrassing viral video, a New York model decides to escape from her suffocating existence by visiting her faraway aunt in Australia.</td>
<td style="text-align: left;">people</td>
<td style="text-align: left;">aunt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I Am Kalam</td>
<td style="text-align: left;">An intelligent boy born into poverty befriends the son of a once noble family and is inspired by the life of India’s president to pursue an education.</td>
<td style="text-align: left;">events</td>
<td style="text-align: left;">birth</td>
</tr>
<tr class="even">
<td style="text-align: left;">If I were an Animal</td>
<td style="text-align: left;">Curious kids Emma and her big brother Tim observe different animals as they make their way through various life milestones, from birth to adulthood.</td>
<td style="text-align: left;">events</td>
<td style="text-align: left;">birth</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="summarize" class="level2">
<h2 class="anchored" data-anchor-id="summarize">Summarize</h2>
<p>To simplify things, let’s take all of the parent and child tags assigned to each movie and bring them together into a comma separated list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tv_groups <span class="ot">&lt;-</span> tv_groups <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(parent)) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(show_id, type, title, country, release_year, description) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarize</span>(<span class="at">parent_nodes =</span> <span class="fu">paste</span>(parent <span class="sc">%&gt;%</span> unique <span class="sc">%&gt;%</span> sort, <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">child_nodes =</span> <span class="fu">paste</span>(child <span class="sc">%&gt;%</span> unique <span class="sc">%&gt;%</span> sort, <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># View groups</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>tv_groups <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(title, description, parent_nodes, child_nodes) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span><span class="fu">nchar</span>(child_nodes)) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 72%">
<col style="width: 4%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">title</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">parent_nodes</th>
<th style="text-align: left;">child_nodes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Snow Day</td>
<td style="text-align: left;">When a snow day shuts down the whole town, the Wheeler family cuts loose. Hal makes a play for the most popular girl in his school, 10-year-old Natalie takes on the dreaded snowplow man, and Dad gets into a showdown with a rival meteorologist.</td>
<td style="text-align: left;">people, places</td>
<td style="text-align: left;">family, father, girl, man, school, town</td>
</tr>
<tr class="even">
<td style="text-align: left;">The Haunted Hathaways</td>
<td style="text-align: left;">Single mom Michelle Hathaway and her daughters find that they share their New Orleans home with the ghosts of single dad Ray Preston and his two sons.</td>
<td style="text-align: left;">people, places</td>
<td style="text-align: left;">daughter, father, home, mother, son</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Riding Faith</td>
<td style="text-align: left;">Following her father’s death, a young woman struggles to help her mother keep the family ranch afloat while preserving a special bond with her horse.</td>
<td style="text-align: left;">events, people</td>
<td style="text-align: left;">death, family, mother, woman</td>
</tr>
<tr class="even">
<td style="text-align: left;">The Breadwinner</td>
<td style="text-align: left;">A courageous 11-year-old Afghan girl disguises herself as a boy and takes on odd jobs to provide for her family when her father is arrested.</td>
<td style="text-align: left;">people</td>
<td style="text-align: left;">boy, family, father, girl</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elf Pets: A Fox Cub’s Christmas Tale</td>
<td style="text-align: left;">An elite team of elves – and their furry fox cub friends – help bring the Christmas spirit to a boy whose mom may not make it home for the holidays.</td>
<td style="text-align: left;">people, places</td>
<td style="text-align: left;">boy, home, mother, team</td>
</tr>
<tr class="even">
<td style="text-align: left;">I Am Kalam</td>
<td style="text-align: left;">An intelligent boy born into poverty befriends the son of a once noble family and is inspired by the life of India’s president to pursue an education.</td>
<td style="text-align: left;">events, people</td>
<td style="text-align: left;">birth, boy, family, son</td>
</tr>
</tbody>
</table>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>